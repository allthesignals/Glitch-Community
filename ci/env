#!/usr/bin/env bash

set -x

# If we have no ENVIRONMENT we set it from CIRCLE_BRANCH
if [ -z "${ENVIRONMENT}" ];
then
  case "${CIRCLE_BRANCH}" in
    master))
      export ENVIRONMENT=production
      ;;
    staging))
      export ENVIRONMENT=staging
      ;;
    *)
      echo "Can't infer ENVIRONMENT from CIRCLE_BRANCH"
      exit 1
  esac
fi

# we set the BOOTSTRAP_BUCKET and JUMP_DOMAIN from the ENVIRONMENT
case "${ENVIRONMENT}" in
  production))
    export BOOTSTRAP_BUCKET=community-bootstrap-bucket20191205165831056600000001
    export JUMP_DOMAIN=jump.staging.glitch.com
    export AWS_BOOTSTRAP_KEY=AKIA6O2CCK6XTDYMEAM4
    export AWS_BOOTSTRAP_SECRET="$STAGING_AWS_BOOTSTRAP_SECRET"
    ;;
  staging))
    export BOOTSTRAP_BUCKET=
    export JUMP_DOMAIN=jump.glitch.com
    export AWS_BOOTSTRAP_KEY=
    export AWS_BOOTSTRAP_SECRET="$PRODUCTION_AWS_BOOTSTRAP_SECRET"
    ;;
  *)
    echo "Unknown environment $ENVIRONMENT"
    exit 1
esac
